<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thai Speech to Text (Real-Time)</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" class="microphone-icon">
                <path d="M25 2A8 8 0 0 0 17 10V25A8 8 0 1 0 33 25V10A8 8 0 0 0 25 2Z" fill="#4CAF50"/>
                <path d="M40 25C40 32.732 33.732 39 26 39H24C16.268 39 10 32.732 10 25" 
                      stroke="#4CAF50" stroke-width="4" fill="none"/>
                <line x1="25" y1="39" x2="25" y2="45" stroke="#4CAF50" stroke-width="4"/>
                <line x1="20" y1="45" x2="30" y2="45" stroke="#4CAF50" stroke-width="4"/>
            </svg>
            <h1>Non Autos Mine</h1>
        </div>
        <div class="speech-controls">
            <button id="startRecording" class="friendly-button start">
                <span>üéôÔ∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏π‡∏î</span>
            </button>
            <button id="stopRecording" class="friendly-button stop" disabled>
                <span>‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏π‡∏î</span>
            </button>
        </div>
        <div class="result">
            <h2>‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</h2>
            <div id="transcript" class="transcript-area">
                <p class="placeholder">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏π‡∏î" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á</p>
            </div>
        </div>
    </div>
    <script src="speech.js"></script>
    <script>
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á Flask API
        async function sendTextToFlask(text) {
            const timestamp = new Date().toISOString(); // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ISO
            try {
                const response = await fetch('http://127.0.0.1:5000/transcribe', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text, timestamp: timestamp }),
                });
                const data = await response.json();
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å Flask API
                document.getElementById("transcript").innerHTML = `<p>${data.received_text}</p>`;
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤ sentiment ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å Flask API
                const sentiment = data.sentiment;  // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ sentiment ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å Flask
                document.getElementById("sentiment").innerHTML = `<p>‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå: ${sentiment}</p>`;
            } catch (error) {
                console.error('Error:', error);
            }
        }
    
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á
        const startButton = document.getElementById('startRecording');
        const stopButton = document.getElementById('stopRecording');
    
        let recognition;
    
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Web Speech API ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.lang = 'th-TH';  // ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            recognition.interimResults = true;
    
            recognition.onstart = function () {
                startButton.disabled = true;
                stopButton.disabled = false;
            };
    
            recognition.onend = function () {
                startButton.disabled = false;
                stopButton.disabled = true;
            };
    
            recognition.onresult = function (event) {
                const transcript = event.results[event.results.length - 1][0].transcript;
                sendTextToFlask(transcript);  // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á‡πÑ‡∏î‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Flask API
                document.getElementById('transcript').innerHTML = `<p>${transcript}</p>`;  // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á‡πÑ‡∏î‡πâ
            };
    
            startButton.addEventListener('click', () => {
                recognition.start();  // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á
            });
    
            stopButton.addEventListener('click', () => {
                recognition.stop();  // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á
            });
        } else {
            alert("Web Speech API ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ");
        }
    </script>
    
    
</body>
</html>
